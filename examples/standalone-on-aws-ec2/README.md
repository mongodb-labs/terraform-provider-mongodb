# Example Terraform HCL file for AWS EC2

- 1.Download the [MongoDB Terraform Provider](https://github.com/mongodb-labs/terraform-provider-mongodb)

- 2.Install it (copy it to `~/.terraform.d/plugins`)

- 3.Prepare the required AWS dependencies:

    - A. a *security group* which should allow the following inbound traffic:
        - external access to the Ops Manager port
        - external access to the SSH port
        - access to the MongoDB port from within the same security group 
    
        Example:
        
        | Type | Protocol | Port Range | Source | Description |
        | ---- | -------- | ---------- | ------ | ----------- |
        | Custom TCP Rule | TCP | 9080 | 0.0.0.0/0 | Ops Manager |
        | SSH | TCP | 22 | 0.0.0.0/0 | SSH |
        | Custom TCP Rule | TCP | 27017 | sg-... | This security group |

  - B. a *subnet* which automatically assigns an IPv4 address and allows inbound/outbound traffic.

- 4.Export the required variables
    - security_group_id
    - subnet_id

```bash
export TF_VAR_security_group_id=...
export TF_VAR_subnet_id=...
```

- 5.Run terraform

```
cd examples/standalone-on-aws-ec2 # this directory
terraform init
terraform plan
terraform apply
```

### Connecting to the host

If you need to connect to the host, you will need to retrieve the SSH key which was generated by terraform.

Run the following command: `TF_LOG=ERROR terraform output ssh_private_key > ~/.ssh/terraform-private.pem`

You can then SSH to your instance with `ssh -i ~/.ssh/terraform-private.pem user@host`.
